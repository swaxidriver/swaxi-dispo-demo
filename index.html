<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>swaxi Dispositions-App ‚Äì Demo v5.3</title>
  <meta name="description" content="Demo v5.3 ‚Äì Grundfunktionen + Add-ons (Live-Update, Changelog, Kalender, Serienbewerbung, Audit, Dark Mode, Tooltips, Mini-Analytics)." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{
      --brand-primary:#222F88; --brand-primary-contrast:#ffffff;
      --brand-accent:#27ADE7;  --brand-surface:#ffffff;
      --brand-bg:#f6f7fb;      --brand-border:#e5e7eb;
      --brand-text:#0f172a;    --muted:#64748b;
      --ok:#16a34a;            --warn:#f59e0b; --err:#dc2626;
    }
    [data-theme="dark"]{
      --brand-primary:#222F88; --brand-primary-contrast:#ffffff;
      --brand-accent:#27ADE7;  --brand-surface:#0b1022;
      --brand-bg:#060918;      --brand-border:#1f2937;
      --brand-text:#e5e7eb;    --muted:#94a3b8;
    }
    html,body{height:100%}
    body{background:var(--brand-bg);color:var(--brand-text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .card{background:var(--brand-surface)}
    .btn{border-radius:.75rem;padding:.5rem .9rem;font-weight:600;border:1px solid var(--brand-border)}
    .btn-primary{background:var(--brand-primary);color:var(--brand-primary-contrast);border-color:transparent}
    .btn-outline{background:transparent;color:var(--brand-text)}
    .chip{border-radius:9999px; padding:.2rem .6rem; font-size:.75rem; border:1px solid var(--brand-border)}
    .chip.ok{background:#dcfce7;color:#14532d;border-color:#bbf7d0}
    .chip.warn{background:#fef3c7;color:#7c2d12;border-color:#fde68a}
    .chip.err{background:#fee2e2;color:#7f1d1d;border-color:#fecaca}
    .brand-gradient{background:linear-gradient(135deg,var(--brand-primary) 0%,var(--brand-accent) 100%)}
    .kbd{border:1px solid var(--brand-border);border-bottom-width:3px;border-radius:.5rem;padding:.15rem .4rem;font-size:.75rem}
    .sticky-footer{position:sticky;bottom:0;z-index:40;border-top:1px solid var(--brand-border);background:var(--brand-surface)}
    .bottom-nav{position:sticky;bottom:0;background:var(--brand-surface);border-top:1px solid var(--brand-border);z-index:40}
    .tooltip{position:absolute;z-index:50;transform:translate(-50%,.3rem);white-space:nowrap;background:rgba(17,24,39,.95);color:#fff;padding:.25rem .5rem;border-radius:.4rem;font-size:.75rem}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;z-index:60}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:.35rem}
    @media (max-width: 768px){ table.responsive{display:none}.svc-card{display:block} }
    @media (min-width: 769px){ .svc-card{display:none} }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {useState,useEffect,useMemo,useCallback,useRef,Fragment} = React;

    // === App Version / Changelog =================================================
    window.__APP_VERSION__ = "5.3.0";
    const CHANGELOG = [
      "v5.3: Live-Update-Banner, Changelog-Modal, Mini-Analytics, Kalender-Tab, Serienbewerbung, Audit-Log (Admin), Dark-Mode, Tooltips, Schnellaktionen (Easter Egg).",
      "Konfliktlogik & Vorlagen je Wochentag, Arbeitsortpflicht, Snapshots/Autosave."
    ];

    // === Utilities ===============================================================
    const uid = () => Math.random().toString(36).slice(2,10);
    const todayISO = () => new Date().toISOString().slice(0,10);
    function addDays(iso,n){ const d=new Date(iso+"T00:00:00"); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10); }
    function fmtDate(iso){ const d=new Date(iso+"T00:00:00"); return d.toLocaleDateString(undefined,{weekday:"short",day:"2-digit",month:"2-digit"}); }
    function fmtDateLong(iso){ const d=new Date(iso+"T00:00:00"); return d.toLocaleDateString(undefined,{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"}); }
    function normalizeTime(t){ const m=/(\d{1,2}):(\d{2})/.exec(t||""); if(!m) return "00:00"; const pad=n=>n.toString().padStart(2,"0"); let hh=Math.min(23,Math.max(0,parseInt(m[1],10))); let mm=Math.min(59,Math.max(0,parseInt(m[2],10))); return pad(hh)+":"+pad(mm); }
    function overlaps(aStart,aEnd,bStart,bEnd){ return aStart<bEnd && bStart<aEnd; }
    function between(isoA, isoB, iso){ return iso>=isoA && iso<=isoB; }
    function saveLS(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
    function loadLS(key,def){ try{ const v=localStorage.getItem(key); return v?JSON.parse(v):def; }catch{ return def; } }

    // === Domain constants ========================================================
    const STATUS={ OFFEN:"Offen", ZUGEWIESEN:"Zugewiesen", ABGESAGT:"Abgesagt" };
    const ROLES=["Disponent","Chief","Admin","Analyst"];
    const QUICK=["Alle","Offen","Zugewiesen","Abgesagt"];
    const HOLIDAYS=["2025-12-24","2025-12-25","2025-12-26","2026-01-01"];
    // Wochentags-Templates (So=0..Sa=6)
    const DEFAULT_TPL={
      0:[{label:"Fr√ºh",start:"11:45",end:"21:00"},{label:"Nacht",start:"21:00",end:"05:30"}],
      1:[{label:"Abend",start:"17:45",end:"21:45"},{label:"Nacht",start:"21:00",end:"05:30"}],
      2:[{label:"Abend",start:"17:45",end:"21:45"},{label:"Nacht",start:"21:00",end:"05:30"}],
      3:[{label:"Abend",start:"17:45",end:"21:45"},{label:"Nacht",start:"21:00",end:"05:30"}],
      4:[{label:"Abend",start:"17:45",end:"21:45"},{label:"Nacht",start:"21:00",end:"05:30"}],
      5:[{label:"Fr√ºh",start:"11:45",end:"21:00"},{label:"Nacht",start:"21:00",end:"05:30"}],
      6:[{label:"Fr√ºh",start:"11:45",end:"21:00"},{label:"Nacht",start:"21:00",end:"05:30"}]
    };

    // === BEGIN ADDON: Audit helpers =============================================
    const AUDIT_KEY="swaxi.v5.audit";
    function logAudit(evt){
      const now=new Date().toISOString();
      const entry={id:uid(), ts:now, ...evt};
      const prev=loadLS(AUDIT_KEY,[]);
      prev.unshift(entry);
      saveLS(AUDIT_KEY,prev);
      return entry;
    }
    // === END ADDON: Audit helpers ===============================================

    // === BEGIN ADDON: Tooltip ====================================================
    function Tooltip({label, children}){
      const [show,setShow]=useState(false);
      return (
        <span className="relative inline-flex" onMouseEnter={()=>setShow(true)} onMouseLeave={()=>setShow(false)} onFocus={()=>setShow(true)} onBlur={()=>setShow(false)} tabIndex={0}>
          {children}
          {show && <span role="tooltip" className="tooltip">{label}</span>}
        </span>
      );
    }
    // === END ADDON: Tooltip ======================================================

    // === BEGIN ADDON: Live Update Banner ========================================
    function LiveUpdateBanner(){
      const [update,setUpdate]=useState(false);
      useEffect(()=>{
        let t=setInterval(async ()=>{
          try{
            const r=await fetch("version.json",{cache:"no-store"});
            if(r.ok){
              const j=await r.json();
              if(j.version && j.version!==window.__APP_VERSION__) setUpdate(true);
            }
          }catch{}
        },60000);
        return ()=>clearInterval(t);
      },[]);
      if(!update) return null;
      return (
        <div className="sticky top-0 z-50 border-b border-[var(--brand-border)] bg-yellow-50 text-yellow-900 px-4 py-2 flex items-center justify-between" aria-live="polite">
          <span className="font-medium">Neue Version verf√ºgbar</span>
          <button className="btn btn-primary ml-3" onClick={()=>location.reload()}>Neu laden</button>
        </div>
      );
    }
    // === END ADDON: Live Update Banner ==========================================

    // === BEGIN ADDON: Changelog Modal ===========================================
    function ChangelogModal({open,onClose}){
      const ref=useRef(null);
      useEffect(()=>{
        function esc(e){ if(e.key==="Escape") onClose(); }
        document.addEventListener("keydown",esc);
        return ()=>document.removeEventListener("keydown",esc);
      },[onClose]);
      if(!open) return null;
      return (
        <div className="modal-backdrop" role="dialog" aria-modal="true">
          <section className="card rounded-2xl max-w-xl w-[92%] p-4">
            <header className="flex items-center justify-between mb-2">
              <h3 className="text-lg font-semibold">Was ist neu? ‚Äì v5.3</h3>
              <button className="btn btn-outline" onClick={onClose}>Schlie√üen</button>
            </header>
            <ul className="list-disc pl-5 text-sm space-y-1">
              {CHANGELOG.map((l,i)=>(<li key={i}>{l}</li>))}
            </ul>
          </section>
        </div>
      );
    }
    // === END ADDON: Changelog Modal =============================================

    // === BEGIN ADDON: Theme Toggle ==============================================
    function ThemeToggle(){
      const [theme,setTheme]=useState(loadLS("swaxi.v5.theme","light"));
      useEffect(()=>{ document.documentElement.setAttribute("data-theme",theme); saveLS("swaxi.v5.theme",theme); },[theme]);
      return (
        <button className="btn btn-outline" onClick={()=>setTheme(t=>t==="light"?"dark":"light")} aria-label="Dark Mode umschalten">
          {theme==="light"?"üåô":"‚òÄÔ∏è"} <span className="ml-1">Theme</span>
        </button>
      );
    }
    // === END ADDON: Theme Toggle ================================================

    // === Data bootstrap ==========================================================
    function seedServices(n=10){
      const res=[];
      let d=todayISO();
      for(let i=0;i<n;i++){
        const dt=d;
        if(HOLIDAYS.includes(dt)){ d=addDays(d,1); continue; }
        const wd=new Date(dt+"T00:00:00").getDay();
        (DEFAULT_TPL[wd]||[]).forEach(t=>{
          res.push({id:uid(), date:dt, label:t.label, start:t.start, end:t.end, location:"B√ºro", status:STATUS.OFFEN});
        });
        d=addDays(d,1);
      }
      return res;
    }

    // === BEGIN ADDON: Mini Analytics ============================================
    function MiniAnalytics({services,bids}){
      const today=todayISO();
      const offene=services.filter(s=>s.status===STATUS.OFFEN).length;
      const heuteUnbesetzt=services.filter(s=>s.date===today && s.status===STATUS.OFFEN).length;
      const conflicts=bids.filter(b=>services.find(s=>s.id===b.serviceId && s.status===STATUS.ZUGEWIESEN)).length;
      const weekBids=bids.filter(b=>b.ts && (new Date(b.ts) >= new Date(addDays(today,-7)))).length;
      const Card=({title,val,sub})=>(
        <div className="card rounded-2xl p-4 border shadow-sm">
          <div className="text-2xl font-bold">{val}</div>
          <div className="text-sm text-[var(--muted)]">{title}</div>
          {sub && <div className="text-xs mt-1">{sub}</div>}
        </div>
      );
      return (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
          <Card title="Offene Schichten" val={offene}/>
          <Card title="Heute unbesetzt" val={heuteUnbesetzt}/>
          <Card title="Konflikte gesamt" val={conflicts}/>
          <Card title="Bewerbungen 7 Tage" val={weekBids}/>
        </div>
      );
    }
    // === END ADDON: Mini Analytics ==============================================

    // === BEGIN ADDON: Calendar View =============================================
    function monthStart(iso){ const d=new Date(iso+"T00:00:00"); d.setDate(1); return d; }
    function CalendarView({services, onSelectDate}){
      const [refDate,setRefDate]=useState(monthStart(todayISO()));
      const year=refDate.getFullYear(), month=refDate.getMonth();
      const first=new Date(year,month,1); const start=new Date(first); start.setDate(first.getDate()-((first.getDay()+6)%7));
      const days=[...Array(42)].map((_,i)=>{ const d=new Date(start); d.setDate(start.getDate()+i); return d; });
      return (
        <div className="card rounded-2xl p-4 border shadow-sm">
          <div className="flex items-center justify-between mb-3">
            <button className="btn btn-outline" onClick={()=>setRefDate(d=>new Date(d.getFullYear(), d.getMonth()-1, 1))}>‚Äπ</button>
            <h3 className="font-semibold">{refDate.toLocaleDateString(undefined,{month:"long", year:"numeric"})}</h3>
            <button className="btn btn-outline" onClick={()=>setRefDate(d=>new Date(d.getFullYear(), d.getMonth()+1, 1))}>‚Ä∫</button>
          </div>
          <div className="calendar-grid text-sm">
            {["Mo","Di","Mi","Do","Fr","Sa","So"].map((w,i)=>(<div key={i} className="text-center text-[var(--muted)]">{w}</div>))}
            {days.map((d,i)=>{
              const iso=d.toISOString().slice(0,10);
              const inMonth=d.getMonth()===month;
              const open=services.filter(s=>s.date===iso && s.status===STATUS.OFFEN).length;
              return (
                <button key={i} onClick={()=>onSelectDate(iso)} className={"rounded-xl p-2 border text-left hover:border-[var(--brand-primary)] "+(inMonth?"":"opacity-50")} style={{borderColor:"var(--brand-border)"}}>
                  <div className="text-xs mb-1">{d.getDate()}</div>
                  {open>0 && <span className="chip warn">{open} offen</span>}
                </button>
              );
            })}
          </div>
        </div>
      );
    }
    // === END ADDON: Calendar View ===============================================

    // === BEGIN ADDON: Bulk Apply Bar ============================================
    function BulkApplyBar({selected,onConfirm}){
      const count=selected.length;
      if(count===0) return null;
      return (
        <div className="sticky-footer px-4 py-3 flex items-center justify-between">
          <div className="text-sm">{count} Schicht{count>1?"en":""} ausgew√§hlt</div>
          <button className="btn btn-primary" onClick={onConfirm}>F√ºr {count} Tag{count>1?"e":""} bewerben</button>
        </div>
      );
    }
    // === END ADDON: Bulk Apply Bar ==============================================

    // === BEGIN ADDON: Audit Tab ==================================================
    function AuditTab(){
      const [items,setItems]=useState(loadLS(AUDIT_KEY,[]));
      useEffect(()=>{
        const h=()=>setItems(loadLS(AUDIT_KEY,[]));
        window.addEventListener("storage",h);
        return ()=>window.removeEventListener("storage",h);
      },[]);
      return (
        <div className="card rounded-2xl p-4 border shadow-sm">
          <h3 className="font-semibold mb-3">Audit-Log</h3>
          <div className="max-h-[50vh] overflow-auto text-sm">
            {items.length===0 && <div className="text-[var(--muted)]">Noch keine √Ñnderungen protokolliert.</div>}
            <ul className="space-y-2">
              {items.map(e=>(
                <li key={e.id} className="border-b pb-2" style={{borderColor:"var(--brand-border)"}}>
                  <div className="font-mono text-xs">{new Date(e.ts).toLocaleString()}</div>
                  <div><span className="chip">{e.role}</span> {e.action}</div>
                  {e.detail && <div className="text-[var(--muted)]">{e.detail}</div>}
                </li>
              ))}
            </ul>
          </div>
        </div>
      );
    }
    // === END ADDON: Audit Tab ====================================================

    // === Main App ================================================================
    function App(){
      // roles & ui
      const [role,setRole]=useState(loadLS("swaxi.v5.role","Disponent"));
      const [tab,setTab]=useState(loadLS("swaxi.v5.tab","Dienste"));
      const [showLog,setShowLog]=useState(false);
      const [notify,setNotify]=useState(false); // Chief Review -> send summary
      // data
      const [services,setServices]=useState(loadLS("swaxi.v5.services", seedServices(10)));
      const [bids,setBids]=useState(loadLS("swaxi.v5.bids", []));
      const [assignments,setAssignments]=useState(loadLS("swaxi.v5.assignments", []));
      // selection for bulk
      const [selected,setSelected]=useState([]);
      const [calendarDate,setCalendarDate]=useState(todayISO());

      // autosave snapshots
      useEffect(()=>{
        const t=setInterval(()=>snapshot(),30000);
        window.addEventListener("beforeunload",snapshot);
        return ()=>{ clearInterval(t); window.removeEventListener("beforeunload",snapshot); }
      });
      function snapshot(){
        saveLS("swaxi.v5.services",services);
        saveLS("swaxi.v5.bids",bids);
        saveLS("swaxi.v5.assignments",assignments);
        saveLS("swaxi.v5.role",role);
        saveLS("swaxi.v5.tab",tab);
      }

      // helpers
      const canEditTemplates = role==="Chief" || role==="Admin";
      const canAssign = role==="Chief" || role==="Admin";
      const canAudit = role==="Admin";

      // conflict checks
      const conflicts = useMemo(()=>{
        const arr=[];
        // Bewerbungen auf zugewiesene Dienste
        bids.forEach(b=>{
          const s=services.find(x=>x.id===b.serviceId);
          if(s && s.status===STATUS.ZUGEWIESEN) arr.push({type:"bid-on-assigned", sid:s.id});
        });
        return arr;
      },[services,bids]);

      // actions
      function addNextNDays(n=10){
        const existing = [...services];
        const startDate = services.length? services.map(s=>s.date).sort()[0] : todayISO();
        const toAdd = seedServices(n);
        // ensure new IDs; simply concat
        const merged = [...existing, ...toAdd];
        setServices(merged);
        logAudit({role, action:`Dienste generiert (${n} Tage)`});
      }

      function toggleSelect(sid){
        setSelected(sel=> sel.includes(sid) ? sel.filter(x=>x!==sid) : [...sel, sid]);
      }

      function applyBulk(){
        const now=new Date().toISOString();
        const newBids = selected.map(sid => ({id:uid(), serviceId:sid, applicant:"disponent@swaxi.demo", comment:"Serienbewerbung", ts:now, isAssigned:false}));
        setBids(prev=>[...newBids,...prev]);
        logAudit({role, action:"Serienbewerbung", detail:`${selected.length} Bewerbungen erstellt`});
        setSelected([]);
      }

      function assignService(sid){
        if(!canAssign) return;
        const bid=bids.find(b=>b.serviceId===sid);
        if(!bid) return;
        setAssignments(a=>[{id:uid(), serviceId:sid, bidId:bid.id, assignedBy:role, assignedOn:new Date().toISOString()},...a]);
        setServices(s=>s.map(x=>x.id===sid?{...x,status:STATUS.ZUGEWIESEN}:x));
        setBids(bs=>bs.map(b=>b.id===bid.id?{...b,isAssigned:true}:b));
        logAudit({role, action:"Zuweisung", detail:`Service ${sid} zugewiesen`});
      }

      function cancelService(sid, reason=""){
        setServices(s=>s.map(x=>x.id===sid?{...x,status:STATUS.ABGESAGT, cancelReason:reason, cancelOn:new Date().toISOString()}:x));
        logAudit({role, action:"Absage", detail:`Service ${sid} abgesagt (${reason})`});
      }

      // notification simulation
      function sendSummary(){
        if(!canAssign || !notify) return;
        const last10=loadLS(AUDIT_KEY,[]).slice(0,10);
        alert("Benachrichtigung an Disponent gesendet (Simulation).\nLetzte √Ñnderungen:\n- "+last10.map(e=>`${new Date(e.ts).toLocaleTimeString()} ${e.action}`).join("\n"));
        setNotify(false);
      }

      // render helpers
      function statusBadge(s){
        const map={[STATUS.OFFEN]:"chip warn",[STATUS.ZUGEWIESEN]:"chip ok",[STATUS.ABGESAGT]:"chip err"};
        return <span className={map[s]||"chip"}>{s}</span>
      }

      // derived
      const servicesByDate = useMemo(()=>{
        const map={};
        services.forEach(s=>{ (map[s.date]=map[s.date]||[]).push(s); });
        return map;
      },[services]);

      return (
        <div className="min-h-screen flex flex-col">
          <LiveUpdateBanner/>

          {/* Header */}
          <header className="brand-gradient text-white">
            <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-9 h-9 rounded-xl bg-white/20 flex items-center justify-center font-bold">sw</div>
                <div>
                  <div className="text-lg font-semibold">swaxi Disposition ‚Äì Demo v5.3</div>
                  <div className="text-xs opacity-80">Erstellt von Benno von Willert ‚Ä¢ {new Date().toISOString().slice(0,10)}</div>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <select className="btn btn-outline" value={role} onChange={e=>setRole(e.target.value)}>
                  {ROLES.map(r=><option key={r}>{r}</option>)}
                </select>
                <ThemeToggle/>
                <button className="btn btn-outline" onClick={()=>setShowLog(true)}>Was ist neu?</button>
              </div>
            </div>
          </header>

          {/* Main */}
          <main className="max-w-6xl mx-auto w-full px-4 py-4 flex-1">
            <MiniAnalytics services={services} bids={bids}/>

            {/* Tabs */}
            <div className="mb-3 flex items-center gap-2">
              {["Dienste","Kalender", ...(canAudit?["Audit"]:[])].map(t=>(
                <button key={t} onClick={()=>setTab(t)} className={"btn "+(tab===t?"btn-primary":"btn-outline")}>{t}</button>
              ))}
            </div>

            {/* Tab: Dienste */}
            {tab==="Dienste" && (
              <section className="space-y-3">
                <div className="card rounded-2xl p-4 border shadow-sm">
                  <div className="flex flex-wrap items-center gap-2">
                    <button className="btn btn-outline" onClick={()=>addNextNDays(10)}>Dienste f√ºr 10 Tage anlegen</button>
                    {canAssign && (
                      <Fragment>
                        <Tooltip label="√Ñnderungen nach Review zusammenfassen und Disponent informieren">
                          <label className="inline-flex items-center gap-2">
                            <input type="checkbox" className="scale-110" checked={notify} onChange={e=>setNotify(e.target.checked)} />
                            <span>Disponent √ºber √Ñnderungen benachrichtigen</span>
                          </label>
                        </Tooltip>
                        <button className="btn btn-outline" onClick={sendSummary} disabled={!notify}>√Ñnderungen ver√∂ffentlichen</button>
                      </Fragment>
                    )}
                    {role==="Disponent" && (
                      <Tooltip label="Easter-Egg">
                        <button className="btn btn-outline" onClick={()=>alert("Ich schmei√ü hier wieder alles durcheinander üòÖ (Demo)")}>Automatisch zuteilen</button>
                      </Tooltip>
                    )}
                  </div>
                </div>

                {/* Services by date */}
                {Object.keys(servicesByDate).sort().map(date=>(
                  <div key={date} className="card rounded-2xl p-4 border shadow-sm">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="font-semibold">{fmtDateLong(date)}</h3>
                      <div className="text-sm text-[var(--muted)]">{servicesByDate[date].length} Dienste</div>
                    </div>
                    <table className="w-full table-fixed responsive">
                      <thead>
                        <tr className="text-left text-sm text-[var(--muted)]">
                          <th className="w-10"></th><th>Schicht</th><th>Zeit</th><th>Ort</th><th>Status</th><th>Aktionen</th>
                        </tr>
                      </thead>
                      <tbody>
                        {servicesByDate[date].map(s=>(
                          <tr key={s.id} className="border-t" style={{borderColor:"var(--brand-border)"}}>
                            <td><input type="checkbox" checked={selected.includes(s.id)} onChange={()=>toggleSelect(s.id)} /></td>
                            <td className="font-medium">{s.label}</td>
                            <td>{s.start}‚Äì{s.end}</td>
                            <td>
                              <select value={s.location} onChange={e=>setServices(arr=>arr.map(x=>x.id===s.id?{...x,location:e.target.value}:x))} className="btn btn-outline">
                                <option>B√ºro</option>
                                <option>Homeoffice</option>
                              </select>
                            </td>
                            <td>{statusBadge(s.status)}</td>
                            <td className="space-x-2">
                              <button className="btn btn-outline" onClick={()=>setBids(b=>[{id:uid(),serviceId:s.id,applicant:"disponent@swaxi.demo",comment:"Bewerbung",ts:new Date().toISOString(),isAssigned:false},...b])}>Bewerben</button>
                              {canAssign && <button className="btn btn-outline" onClick={()=>assignService(s.id)} disabled={s.status!==STATUS.OFFEN}>Zuweisen</button>}
                              {canAssign && <button className="btn btn-outline" onClick={()=>cancelService(s.id,"Kurzfristige √Ñnderung")}>Absagen</button>}
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>

                    {/* mobile cards */}
                    <div className="svc-card space-y-2">
                      {servicesByDate[date].map(s=>(
                        <div key={s.id} className="rounded-xl border p-3" style={{borderColor:"var(--brand-border)"}}>
                          <div className="flex items-center justify-between">
                            <div className="font-medium">{s.label}</div>
                            {statusBadge(s.status)}
                          </div>
                          <div className="text-sm">{s.start}‚Äì{s.end}</div>
                          <div className="mt-2 flex items-center gap-2">
                            <select value={s.location} onChange={e=>setServices(arr=>arr.map(x=>x.id===s.id?{...x,location:e.target.value}:x))} className="btn btn-outline">
                              <option>B√ºro</option><option>Homeoffice</option>
                            </select>
                            <input type="checkbox" checked={selected.includes(s.id)} onChange={()=>toggleSelect(s.id)} />
                          </div>
                          <div className="mt-2 flex gap-2">
                            <button className="btn btn-outline" onClick={()=>setBids(b=>[{id:uid(),serviceId:s.id,applicant:"disponent@swaxi.demo",comment:"Bewerbung",ts:new Date().toISOString(),isAssigned:false},...b])}>Bewerben</button>
                            {canAssign && <button className="btn btn-outline" onClick={()=>assignService(s.id)} disabled={s.status!==STATUS.OFFEN}>Zuweisen</button>}
                            {canAssign && <button className="btn btn-outline" onClick={()=>cancelService(s.id,"Kurzfristige √Ñnderung")}>Absagen</button>}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
                <BulkApplyBar selected={selected} onConfirm={applyBulk}/>
              </section>
            )}

            {/* Tab: Kalender */}
            {tab==="Kalender" && (
              <div className="space-y-3">
                <CalendarView services={services} onSelectDate={setCalendarDate}/>
                <div className="card rounded-2xl p-4 border shadow-sm">
                  <h3 className="font-semibold mb-2">Details {fmtDateLong(calendarDate)}</h3>
                  <div className="space-y-2">
                    {services.filter(s=>s.date===calendarDate).map(s=>(
                      <div key={s.id} className="flex items-center justify-between border rounded-xl p-3" style={{borderColor:"var(--brand-border)"}}>
                        <div className="flex items-center gap-3">
                          <span className="font-medium">{s.label}</span>
                          <span className="text-sm">{s.start}‚Äì{s.end}</span>
                          {statusBadge(s.status)}
                        </div>
                        <div className="flex items-center gap-2">
                          <button className="btn btn-outline" onClick={()=>setBids(b=>[{id:uid(),serviceId:s.id,applicant:"disponent@swaxi.demo",comment:"Kalender-Bewerbung",ts:new Date().toISOString(),isAssigned:false},...b])}>Bewerben</button>
                          {canAssign && <button className="btn btn-outline" onClick={()=>assignService(s.id)} disabled={s.status!==STATUS.OFFEN}>Besetzen</button>}
                        </div>
                      </div>
                    ))}
                    {services.filter(s=>s.date===calendarDate).length===0 && <div className="text-[var(--muted)] text-sm">Keine Dienste an diesem Tag.</div>}
                  </div>
                </div>
              </div>
            )}

            {/* Tab: Audit */}
            {tab==="Audit" && canAudit && <AuditTab/>}
          </main>

          {/* Footer */}
          <footer className="text-xs text-[var(--muted)] max-w-6xl mx-auto w-full px-4 py-6">
            <div className="flex items-center justify-between">
              <div>¬© {new Date().getFullYear()} swaxi ‚Ä¢ Demo v5.3 ‚Ä¢ Erstellt von Benno von Willert</div>
              <div>CD: Farben &amp; Logo integriert ‚Ä¢ <span className="kbd">v{window.__APP_VERSION__}</span></div>
            </div>
          </footer>

          <ChangelogModal open={showLog} onClose={()=>setShowLog(false)}/>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>